<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Medical Class Photo Gallery</title>
  
  <!--
  HOW TO USE THIS FILE (CSV MODE)
  1) Put this file anywhere on your computer or host it on a simple web host.
  2) Create an `images/` folder beside it and place your photos there.
  3) Prepare a CSV with headers:
       src,caption,full,alt
     - src: thumbnail or normal image path (relative to this file, e.g. images/jane-doe.jpg)
     - caption: the name shown under the image (e.g. Dr Jane Doe)
     - full (optional): large/original image path (if blank, src is used)
     - alt (optional): accessible description; if blank, caption is used
  4) Click “Import CSV” at the top and select your CSV. The grid will populate automatically.

  Tips
  - For fast load times, use smaller images for `src` and keep `full` as the original.
  - If your CSV paths don’t include the folder, set a Base Path (e.g. images/) and we’ll prepend it.
  - You can still hand‑edit or add <figure> blocks manually if you like.
  -->

  <style>
    :root{
      --bg: #0b0d10;
      --panel: #111418;
      --text: #e8eef2;
      --muted: #a8b3bd;
      --accent: #6bb1ff;
      --gap: 1rem;
      --radius: 14px;
    }
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: linear-gradient(180deg, #0d1116, #0b0d10);
      color: var(--text);
    }
    header{max-width: 1100px; margin: 2rem auto 0; padding: 0 1rem;}
    header h1{font-weight:700; letter-spacing:0.2px; margin:0 0 .25rem 0}
    header p{margin:0; color:var(--muted)}

    .controls{max-width:1100px; margin:1rem auto 0; padding: 0 1rem}
    .panel{background: var(--panel); border:1px solid #1a1f25; border-radius: var(--radius); padding: .9rem; display:flex; flex-wrap: wrap; gap:.8rem; align-items:center}
    .panel label{font-size:.95rem; color:var(--muted)}
    .panel input[type="text"]{background:#0e1318; border:1px solid #2a323a; color:var(--text); padding:.55rem .6rem; border-radius:10px; min-width: 220px}
    .panel input[type="file"]{accent-color: var(--accent)}
    .panel button{background:#15202b; border:1px solid #2a323a; color:var(--text); padding:.55rem .8rem; border-radius:10px; cursor:pointer}
    .panel button:hover{background:#1a2733}
    .hint{font-size:.9rem; color:var(--muted)}

    .wrap{max-width:1100px; margin: 1rem auto 3rem; padding: 0 1rem}

    .grid{display:grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: var(--gap)}
    figure{margin:0; background: var(--panel); border-radius: var(--radius); overflow: hidden; border: 1px solid #1a1f25}
    figure img{display:block; width:100%; height:auto; aspect-ratio: 4/3; object-fit:cover; transition: transform .2s ease}
    figure:hover img{transform: scale(1.02)}
    figcaption{padding: .6rem .8rem; text-align:center; font-size:.95rem; color: var(--text); border-top: 1px solid #1a1f25}

    /* Lightbox */
    .lightbox{position: fixed; inset:0; display:none; align-items:center; justify-content:center; backdrop-filter: blur(6px); background: rgba(0,0,0,.66); z-index:9999}
    .lightbox[aria-hidden="false"]{display:flex}
    .lb-stage{position: relative; width: min(96vw, 1400px); height: min(92vh, 900px); display:flex; align-items:center; justify-content:center}
    .lb-img{max-width:100%; max-height:100%; user-select:none; cursor: zoom-in; transition: transform .15s ease}
    .lb-zoomed{cursor: grab}
    .lb-caption{position:absolute; left:0; right:0; bottom:0; padding: .6rem 1rem; text-align:center; color: var(--text); background: linear-gradient(180deg, transparent, rgba(0,0,0,.75)); font-size:1rem}

    .lb-controls{position:absolute; inset:0; pointer-events:none}
    .lb-btn{pointer-events:auto; position:absolute; top:50%; transform: translateY(-50%); background: rgba(17,20,24,.8); border:1px solid #2a323a; color:var(--text); width:44px; height:44px; border-radius:10px; display:grid; place-items:center; font-size:22px}
    .lb-btn:hover{background: rgba(17,20,24,.95)}
    .prev{left:12px}
    .next{right:12px}

    .close{pointer-events:auto; position:absolute; top:12px; right:12px; background: rgba(17,20,24,.8); border:1px solid #2a323a; color:var(--text); width:44px; height:44px; border-radius:10px; font-size:22px; display:grid; place-items:center}
    .close:hover{background: rgba(17,20,24,.95)}

    .help{position:absolute; top:12px; left:12px; pointer-events:none; color:var(--muted); font-size:.9rem; opacity:.85}
    .kbd{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:#0e1318; border:1px solid #2a323a; padding:.05rem .35rem; border-radius:6px}

    @media (max-width:520px){figcaption{font-size:.9rem}.lb-caption{font-size:.95rem}}
  </style>
</head>
<body>
  <header>
    <h1>Dad’s Medical Class</h1>
    <p>Click a photo to view and zoom. Use arrow keys to navigate; press Esc to close.</p>
  </header>

  <div class="controls">
    <div class="panel" role="group" aria-label="Import controls">
      <label for="csvInput"><strong>Import CSV:</strong></label>
      <input id="csvInput" type="file" accept=".csv" />
      <label for="basePath">Base Path:</label>
      <input id="basePath" type="text" placeholder="e.g. images/" />
      <button id="clearBtn" title="Remove all current items">Clear grid</button>
      <span class="hint">CSV headers: <code>src,caption,full,alt</code></span>
    </div>
  </div>

  <div class="wrap">
    <main class="grid" id="grid" aria-live="polite">
      <!-- Optional: you can keep some starter figures here; CSV import will append -->
      <figure>
        <img src="images/example-1.jpg" data-full="images/example-1.jpg" alt="Portrait of Dr. Jane Doe, 1972" loading="lazy" decoding="async" sizes="(max-width: 600px) 100vw, 33vw" />
        <figcaption>Dr Jane Doe</figcaption>
      </figure>
    </main>
  </div>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="lb-stage" id="stage">
      <img id="lbImg" class="lb-img" alt="" />
      <p id="lbCap" class="lb-caption" aria-live="polite"></p>
      <div class="lb-controls">
        <button class="lb-btn prev" id="prevBtn" aria-label="Previous image" title="Previous (←)">❮</button>
        <button class="lb-btn next" id="nextBtn" aria-label="Next image" title="Next (→)">❯</button>
      </div>
      <button class="close" id="closeBtn" aria-label="Close (Esc)" title="Close (Esc)">✕</button>
      <div class="help">Click to <span class="kbd">zoom</span>; drag to pan; 
        <span class="kbd">←</span>/<span class="kbd">→</span> to navigate</div>
    </div>
  </div>

  <script>
    // --- Minimal CSV parser (handles quotes, commas, newlines) ---
    function parseCSV(text){
      const rows = [];
      let i=0, field='', row=[], inQuotes=false;
      while(i < text.length){
        const c = text[i];
        if(inQuotes){
          if(c === '"'){
            if(text[i+1] === '"'){ field += '"'; i++; }
            else { inQuotes = false; }
          } else { field += c; }
        } else {
          if(c === '"') inQuotes = true;
          else if(c === ','){ row.push(field); field=''; }
          else if(c === '\n' || c === '\r'){
            if(field !== '' || row.length){ row.push(field); rows.push(row); row=[]; field=''; }
            // handle \r\n
            if(c==='\r' && text[i+1]==='\n') i++;
          } else { field += c; }
        }
        i++;
      }
      if(field !== '' || row.length){ row.push(field); rows.push(row); }
      // Trim BOM from first cell if present
      if(rows.length && rows[0].length){ rows[0][0] = rows[0][0].replace(/^\uFEFF/, ''); }
      // Map to objects by header
      const header = rows.shift().map(h=>h.trim());
      return rows.filter(r=>r.some(v=>v && v.trim()!==''))
                 .map(r=>{
                    const obj={};
                    header.forEach((h,idx)=> obj[h]= (r[idx]||'').trim());
                    return obj;
                  });
    }

    function makeFigure({src, full, caption, alt}){
      const fig = document.createElement('figure');
      const img = document.createElement('img');
      const cap = document.createElement('figcaption');
      img.src = src; img.decoding = 'async'; img.loading = 'lazy';
      if(full) img.dataset.full = full;
      img.alt = alt || caption || '';
      img.sizes = '(max-width: 600px) 100vw, 33vw';
      cap.textContent = caption || '';
      fig.appendChild(img); fig.appendChild(cap);
      return fig;
    }

    function populateFromCSVObjects(list, base){
      const grid = document.getElementById('grid');
      const toAbs = (p)=> !p ? '' : (base ? base.replace(/\/$/, '') + '/' + p.replace(/^\//,'') : p);
      const startCount = grid.children.length;
      list.forEach(item=>{
        const src = toAbs(item.src);
        const full = toAbs(item.full || item.src);
        const caption = item.caption || '';
        const alt = item.alt || caption;
        const fig = makeFigure({src, full, caption, alt});
        grid.appendChild(fig);
      });
      wireGrid();
      return grid.children.length - startCount;
    }

    function clearGrid(){
      const grid = document.getElementById('grid');
      grid.innerHTML = '';
    }

    // --- Lightbox logic (updated to re-scan when grid changes) ---
    let items = [];
    const lb = document.getElementById('lightbox');
    const lbImg = document.getElementById('lbImg');
    const lbCap = document.getElementById('lbCap');
    const closeBtn = document.getElementById('closeBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const stage = document.getElementById('stage');

    let index = 0; 
    let zoomed = false; 
    let startX = 0, startY = 0; 
    let offsetX = 0, offsetY = 0;
    let dragging = false;
    const ZOOM_SCALE = 2.4;

    function scanItems(){
      const figures = Array.from(document.querySelectorAll('.grid figure'));
      items = figures.map((fig) => {
        const img = fig.querySelector('img');
        const cap = fig.querySelector('figcaption');
        return {
          el: fig,
          thumb: img.getAttribute('src'),
          full: img.dataset.full || img.getAttribute('src'),
          alt: img.getAttribute('alt') || '',
          caption: cap ? cap.textContent.trim() : ''
        };
      });
      // Click/keyboard handlers
      figures.forEach((fig, i) => {
        fig.tabIndex = 0;
        fig.onclick = () => open(i);
        fig.onkeydown = (e) => { if(e.key==='Enter'||e.key===' '){ e.preventDefault(); open(i); }};
      });
    }

    function open(i){ index = i; update(); lb.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; lbImg.focus(); }
    function close(){ lb.setAttribute('aria-hidden','true'); document.body.style.overflow=''; resetZoom(); }
    function update(){ const it = items[index]; lbImg.src = it.full; lbImg.alt = it.alt || it.caption; lbCap.textContent = it.caption; resetZoom(); }
    function prev(){ index = (index - 1 + items.length) % items.length; update(); }
    function next(){ index = (index + 1) % items.length; update(); }
    function resetZoom(){ zoomed=false; offsetX=0; offsetY=0; dragging=false; lbImg.classList.remove('lb-zoomed'); lbImg.style.transform='translate(0px,0px) scale(1)'; }
    function toggleZoom(){ zoomed=!zoomed; if(zoomed){ lbImg.classList.add('lb-zoomed'); lbImg.style.transform=`translate(0px,0px) scale(${ZOOM_SCALE})`; } else { resetZoom(); } }
    function onDown(e){ if(!zoomed) return; dragging=true; lbImg.style.cursor='grabbing'; startX=(e.touches?e.touches[0].clientX:e.clientX)-offsetX; startY=(e.touches?e.touches[0].clientY:e.clientY)-offsetY; }
    function onMove(e){ if(!dragging) return; const x=(e.touches?e.touches[0].clientX:e.clientX); const y=(e.touches?e.touches[0].clientY:e.clientY); offsetX=x-startX; offsetY=y-startY; lbImg.style.transform=`translate(${offsetX}px, ${offsetY}px) scale(${ZOOM_SCALE})`; }
    function onUp(){ if(!zoomed) return; dragging=false; lbImg.style.cursor='grab'; }

    function wireGrid(){ scanItems(); }

    // initial scan for any hard-coded figures
    wireGrid();

    // Lightbox controls
    lb.addEventListener('click', (e) => { if(e.target === lb) close(); });
    closeBtn.addEventListener('click', close);
    prevBtn.addEventListener('click', prev);
    nextBtn.addEventListener('click', next);
    lbImg.addEventListener('click', toggleZoom);
    lbImg.addEventListener('mousedown', onDown);
    window.addEventListener('mousemove', onMove);
    window.addEventListener('mouseup', onUp);
    lbImg.addEventListener('touchstart', onDown, {passive:true});
    lbImg.addEventListener('touchmove', onMove, {passive:true});
    lbImg.addEventListener('touchend', onUp);
    window.addEventListener('keydown', (e) => {
      if(lb.getAttribute('aria-hidden') === 'true') return;
      if(e.key === 'Escape') close();
      else if(e.key === 'ArrowLeft') prev();
      else if(e.key === 'ArrowRight') next();
      else if(e.key === 'Enter'){ toggleZoom(); }
    });
    lbImg.addEventListener('dragstart', (e)=> e.preventDefault());

    // --- CSV import wiring ---
    const csvInput = document.getElementById('csvInput');
    const basePathInput = document.getElementById('basePath');
    const clearBtn = document.getElementById('clearBtn');

    clearBtn.addEventListener('click', () => { clearGrid(); wireGrid(); });

    csvInput.addEventListener('change', () => {
      const file = csvInput.files && csvInput.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = (e) => {
        try{
          const text = e.target.result;
          const rows = parseCSV(text);
          if(!rows.length){ alert('No rows found in CSV. Make sure the first row has headers: src,caption,full,alt'); return; }
          const base = basePathInput.value.trim();
          const added = populateFromCSVObjects(rows, base);
          alert(`Imported ${added} photos from CSV.`);
        }catch(err){
          console.error(err);
          alert('Sorry, there was a problem reading the CSV.');
        }
      };
      reader.readAsText(file);
    });
  </script>
</body>
</html>